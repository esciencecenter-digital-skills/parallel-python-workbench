<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Lesson Title: Asyncio</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><abbr class="badge badge-light" title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team." style="background-color: #001483; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link" style="color: #FFF7F1">
            <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
            Beta
          </a>
          <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/extra-asyncio.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Lesson Title
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Lesson Title
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Lesson Title
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 77%" class="percentage">
    77%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 77%" aria-valuenow="77" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/extra-asyncio.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. introduction</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="benchmarking.html">2. Benchmarking</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="computing-pi.html">3. Computing $\pi$</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="threads-and-processes.html">4. Threads and processes</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="delayed-evaluation.html">5. Delayed evaluation</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="map-and-reduce.html">6. Map and reduce</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="exercise-with-fractals.html">7. Exercise with Fractals</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        8. Asyncio
        </span>
      
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="extra-external-c.html">9. Calling external C and C++ libraries from Python</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="exercise-with-fractals.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="extra-external-c.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="exercise-with-fractals.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Exercise with
        </a>
        <a class="chapter-link float-end" href="extra-external-c.html" rel="next">
          Next: Calling external C... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Asyncio</h1>
        <p>Last updated on 2023-07-03 |
        
        <a href="https://example.com/template-source/edit/main/episodes/extra-asyncio.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What is Asyncio?</li>
<li>When is asyncio usefull?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understand the difference between a coroutine and a function.</li>
<li>Know the rudimentary basics of <code>asyncio</code>.</li>
<li>Perform parallel computations in <code>asyncio</code>.</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="introduction-to-asyncio">Introduction to Asyncio<a class="anchor" aria-label="anchor" href="#introduction-to-asyncio"></a></h1>
<p>Asyncio stands for “asynchronous IO”, and as you might have guessed
it has little to do with either asynchronous work or doing IO. In
general, asynchronous is an adjective describing objects or events that
are not coordinated in time. In fact, the <code>asyncio</code> system is
more like a carefully tuned set of gears running a multitude of tasks
<em>as if</em> you have a lot of OS threads running. In the end they are
all powered by the same crank. The gears in <code>asyncio</code> are
called <strong>coroutines</strong>, its teeth moving other coroutines
wherever you find the <code>await</code> keyword.</p>
<p>The main application for <code>asyncio</code> is hosting back-ends
for web services, where a lot of tasks may be waiting on each other,
while the server still needs to be responsive to new events. In that
respect, <code>asyncio</code> is a little bit outside the domain of
computational science. Nevertheless, you may encounter async code in the
wild, and you <em>can</em> do parallelism with <code>asyncio</code> if
you want a higher level abstraction but don’t want to depend on
<code>dask</code> or a similar alternative.</p>
<p>Many modern programming languages have features that are very similar
to <code>asyncio</code>.</p>
<div class="section level2">
<h2 id="run-time">Run-time<a class="anchor" aria-label="anchor" href="#run-time"></a></h2>
<p>The main point of <code>asyncio</code> is that it offers a different
formalism for doing work than what you’re used to from functions. To see
what that means, we need to understand functions a bit better.</p>
<div class="section level3">
<h3 id="call-stacks">Call stacks<a class="anchor" aria-label="anchor" href="#call-stacks"></a></h3>
<p>A function call is best understood in terms of a stack based system.
When you call a function, you give it its arguments and forget for the
moment what you were doing. Or rather, whatever you were doing, push it
on a stack and forget about it. Then, with a clean sheet (called a stack
frame), you start working on the given arguments until you arrive at a
result. This result is what you remember, when you go back to the stack
to see what you needed it for in the first place. In this manner, every
function call pushes a frame to the stack, and every return statement,
we pop back to the previous.</p>
<p><a href="https://mermaid.live/edit#pako:eNp1kL1Ow0AQhF9luSYgHApEdUUogpCoKRCSm8U3JpbtXXM_NlGUd-dMYgqkdKvb-Wb25mAqdTDWBHwlSIWnhj8996UQcRWbkSNoy10HPz-dpvVmc_ucJK9VLG01dY72mmjowAHEEiZ46mFp2nGkJlB9_X3zOBssWLZYn8wsvSMUFHd_YNY_3N9dinubLScOv8TgMTaawhm9GPFCTmUVqRWdCpqwGkGCMYeFQVsIfaBWj6uZF81f1nm30BCXk3TpxeFfM6YwPXzPjctFHmZJafJ1PUpj8-jYt6Up5Zh1nKK-7qUyNvqEwqTBZZ9z6cbW3AUcfwB5sYta" class="external-link"><img src="https://mermaid.ink/img/pako:eNp1kL1Ow0AQhF9luSYgHApEdUUogpCoKRCSm8U3JpbtXXM_NlGUd-dMYgqkdKvb-Wb25mAqdTDWBHwlSIWnhj8996UQcRWbkSNoy10HPz-dpvVmc_ucJK9VLG01dY72mmjowAHEEiZ46mFp2nGkJlB9_X3zOBssWLZYn8wsvSMUFHd_YNY_3N9dinubLScOv8TgMTaawhm9GPFCTmUVqRWdCpqwGkGCMYeFQVsIfaBWj6uZF81f1nm30BCXk3TpxeFfM6YwPXzPjctFHmZJafJ1PUpj8-jYt6Up5Zh1nKK-7qUyNvqEwqTBZZ9z6cbW3AUcfwB5sYta?type=png" class="figure"></a></p>
<details><summary>
Mermaid code for above diagram
</summary><pre class="mermaid"><code>sequenceDiagram
  Caller-&gt;&gt;+Function: Could you please answer me: what is f(x)?
  Function-&gt;&gt;-Caller: Yes, the answer is 42.
  Caller-&gt;&gt;+Function: What was the previous answer?
  Function-&gt;&gt;-Caller: I don't know, we've never spoken before!</code></pre>
</details><p>Crucially, when we pop back, we forget about the stack frame inside
the function. This way, there is always a single concious stream of
thought. Function calls can be evaluated by a single active agent.</p>
</div>
<div class="section level3">
<h3 id="coroutines">Coroutines<a class="anchor" aria-label="anchor" href="#coroutines"></a></h3>

<p>When working with coroutines, things are a bit different. When a
result is returned from a coroutine, the coroutine keeps existing, its
context is not forgotten. Coroutines exist in Python in several forms,
the simplest being a <strong>generator</strong>. The following generator
produces all integers (if you wait long enough):</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">def</span> integers():</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="cf">yield</span> a</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    a <span class="op">+=</span> <span class="dv">1</span></span></code></pre>
</div>
<p>Then</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> integers():</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="bu">print</span>(i)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">10</span>:   <span class="co"># or this would take a while</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre>
</div>
<p>or</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> islice</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>islice(integers(), <span class="dv">0</span>, <span class="dv">10</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</code></pre>
</div>
<p><a href="https://mermaid.live/edit#pako:eNqtkT1Pw0AMhv-KuYWBdIDxhjAEqepUJAaWLG7OTU-9j-DzlUZV_zsXhQgqMbJZ9vPafu2L6qIhpVWij0yhoxeLPaNvAwB2Yk8oBA06Rzyl5mhV1w-bINQTJw2vjjARJEEW6GIOYkP_Cy70D_x-QAGbQA4Egc4CIfsd8fPEL9SkmLUaHv-r0dNUCLG4iSdiWNIUDAwcF8uG_jC9bm5Hb-49pMg8VjDGDJ_EBPvIfRShALiLWe5u1qjr1brRsD1WRetcOVUcgM42zZdSlfLEHq0pf7hMylYVW55apUtokI-tasO1cJglvo2hU1o4U6XyYMqu3z9Teo8u0fUL2jOgcw" class="external-link"><img src="https://mermaid.ink/img/pako:eNqtkT1Pw0AMhv-KuYWBdIDxhjAEqepUJAaWLG7OTU-9j-DzlUZV_zsXhQgqMbJZ9vPafu2L6qIhpVWij0yhoxeLPaNvAwB2Yk8oBA06Rzyl5mhV1w-bINQTJw2vjjARJEEW6GIOYkP_Cy70D_x-QAGbQA4Egc4CIfsd8fPEL9SkmLUaHv-r0dNUCLG4iSdiWNIUDAwcF8uG_jC9bm5Hb-49pMg8VjDGDJ_EBPvIfRShALiLWe5u1qjr1brRsD1WRetcOVUcgM42zZdSlfLEHq0pf7hMylYVW55apUtokI-tasO1cJglvo2hU1o4U6XyYMqu3z9Teo8u0fUL2jOgcw?type=png" class="figure"></a></p>
<details><summary>
Mermaid code for above diagram
</summary><pre class="mermaid"><code>sequenceDiagram
  Caller-&gt;&gt;+Integers: Please start counting
  Caller--&gt;&gt;Integers: What is the next number?
  Integers--&gt;&gt;Caller: 1
  Caller--&gt;&gt;Integers: What is the next number?
  Integers--&gt;&gt;Caller: 2
  GC--&gt;&gt;Integers: I'm sorry, you were forgotten about!
  Integers-&gt;&gt;-GC: Ok, I'll stop existing</code></pre>
</details><div id="challenge-generate-all-even-numbers" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-generate-all-even-numbers" class="callout-inner">
<h3 class="callout-title">Challenge: generate all even numbers<a class="anchor" aria-label="anchor" href="#challenge-generate-all-even-numbers"></a>
</h3>
<div class="callout-content">
<p>Can you write a generator that generates all even numbers? Try to
reuse <code>integers()</code>. Extra: Can you generate the Fibonacci
numbers?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">def</span> even_integers():</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> integers():</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>      <span class="cf">yield</span> i</span></code></pre>
</div>
<p>or</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">def</span> even_integers():</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="cf">return</span> (i <span class="cf">for</span> i <span class="kw">in</span> integers() <span class="cf">if</span> i <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>)</span></code></pre>
</div>
<p>For the Fibonacci numbers:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">def</span> fib():</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  a, b <span class="op">=</span> <span class="dv">1</span>, <span class="dv">1</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="cf">yield</span> a</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    a, b <span class="op">=</span> b, a <span class="op">+</span> b</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The generator gives away control, passing a value back, expecting,
maybe, if faith has it, that control will be passed back to it in the
future. The keyword <code>yield</code> applies in all its meanings:
control is yielded, and we have a yield in terms of harvesting a
crop.</p>
<p>A generator conceptually only has one-way traffic: we get output. We
can also use <code>yield</code> the other way around: it can be used to
send information to a coroutine. For instance: we can have a coroutine
that prints whatever you send to it.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="kw">def</span> printer():</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    x <span class="op">=</span> <span class="cf">yield</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    <span class="bu">print</span>(x)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>p <span class="op">=</span> printer()</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="bu">next</span>(p)   <span class="co"># we need to advance the coroutine to the first yield</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>p.send(<span class="st">"Mercury"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>p.send(<span class="st">"Venus"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>p.send(<span class="st">"Earth"</span>)</span></code></pre>
</div>
<div id="challenge-line-numbers" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-line-numbers" class="callout-inner">
<h3 class="callout-title">Challenge: line numbers<a class="anchor" aria-label="anchor" href="#challenge-line-numbers"></a>
</h3>
<div class="callout-content">
<p>Change <code>printer</code> to add line numbers to the output.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">def</span> printer():</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  lineno <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    x <span class="op">=</span> <span class="cf">yield</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>lineno<span class="sc">:03}</span><span class="ss"> </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">"</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>In practice, the <code>send</code> form of coroutines is hardly ever
used. Cases where you’d need it are rare, and chances are noone will
understand your code. Where it was needed before, its use is now largely
superceded by <code>asyncio</code>.</p>
<p>Now that you have seen coroutines, it is a small step towards
<code>asyncio</code>. The idea is that you can use coroutines to build a
collaborative multi-threading environment. In most modern operating
systems, execution threads are given some time, and then when the OS
needs to do something else, control is taken away pre-emptively. In
<strong>collaborative multi-tasking</strong>, every worker knows it is
part of a collaborative, and it voluntarily yields control to the
scheduler. With coroutines and <code>yield</code> you should be able to
see that it is possible to create such a system, but it is not so
straight forward, especially when you start to consider the propagation
of exceptions.</p>
</div>
</div>
<div class="section level2">
<h2 id="syntax">Syntax<a class="anchor" aria-label="anchor" href="#syntax"></a></h2>
<p>While <code>asyncio</code> itself is a library in standard Python,
this library is actually a core component for using the associated async
syntax. There are two keywords here: <code>async</code> and
<code>await</code>.</p>
<p><code>async</code> Is a modifier keyword that modifies the behaviour
of any subsequent syntax to behave in a manner that is consistent with
the asynchronous run-time.</p>
<p><code>await</code> Is used inside a coroutine to wait for another
coroutine to yield a result. Effectively, control is passed back to the
scheduler, which may decide to give back control when a result is
present.</p>
</div>
</div>
<div class="section level1">
<h1 id="a-first-program">A first program<a class="anchor" aria-label="anchor" href="#a-first-program"></a></h1>
<p>Jupyter understands asynchronous code, so you can <code>await</code>
futures in any cell.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> counter(name):</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">:&lt;10}</span><span class="ss"> </span><span class="sc">{</span>i<span class="sc">:03}</span><span class="ss">"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    <span class="cf">await</span> asyncio.sleep(<span class="fl">0.2</span>)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="cf">await</span> counter(<span class="st">"Venus"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Venus      000
Venus      001
Venus      002
Venus      003
Venus      004</code></pre>
</div>
<p>We can have coroutines work concurrently when we <code>gather</code>
two coroutines.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="cf">await</span> asyncio.gather(counter(<span class="st">"Earth"</span>), counter(<span class="st">"Moon"</span>))</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Earth      000
Moon       000
Earth      001
Moon       001
Earth      002
Moon       002
Earth      003
Moon       003
Earth      004
Moon       004</code></pre>
</div>
<p>Note that, although the Earth counter and Moon counter seem to
operate at the same time, in actuality they are alternated by the
scheduler and still running in a single thread! If you work outside the
confines of Jupyter, you need to make sure to create an asynchronous
main function and run it using <code>asyncio.run</code>. A typical
program will look like this:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>...</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> main():</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>    ...</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>    asyncio.run(main())</span></code></pre>
</div>
<p>Asyncio, just like we saw with Dask, is contagious. Once you have
async code at some low level, higher level code also needs to be async:
<a href="https://en.wikipedia.org/wiki/Turtles_all_the_way_down" class="external-link">it’s
turtles all the way down</a>! You may be tempted to do
<code>asyncio.run</code> somewhere from the middle of your normal code
to interact with the asyncronous parts. This can get you into trouble
though, when you get multiple active asyncio run-times. While it is in
principle possible to mix asyncio and classic code, it is in general
considered bad practice to do so.</p>
<div class="section level2">
<h2 id="timing-asynchronous-code">Timing asynchronous code<a class="anchor" aria-label="anchor" href="#timing-asynchronous-code"></a></h2>
<p>While Jupyter works very well with <code>asyncio</code>, one thing
that doesn’t work is line or cell-magic. We’ll have to write our own
timer.</p>

<div class="codewrapper sourceCode" id="async-timer">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="async-timer-1"><a href="#async-timer-1" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass</span>
<span id="async-timer-2"><a href="#async-timer-2" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="async-timer-3"><a href="#async-timer-3" tabindex="-1"></a><span class="im">from</span> time <span class="im">import</span> perf_counter</span>
<span id="async-timer-4"><a href="#async-timer-4" tabindex="-1"></a><span class="im">from</span> contextlib <span class="im">import</span> asynccontextmanager</span>
<span id="async-timer-5"><a href="#async-timer-5" tabindex="-1"></a></span>
<span id="async-timer-6"><a href="#async-timer-6" tabindex="-1"></a></span>
<span id="async-timer-7"><a href="#async-timer-7" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="async-timer-8"><a href="#async-timer-8" tabindex="-1"></a><span class="kw">class</span> Elapsed:</span>
<span id="async-timer-9"><a href="#async-timer-9" tabindex="-1"></a>    time: Optional[<span class="bu">float</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="async-timer-10"><a href="#async-timer-10" tabindex="-1"></a></span>
<span id="async-timer-11"><a href="#async-timer-11" tabindex="-1"></a></span>
<span id="async-timer-12"><a href="#async-timer-12" tabindex="-1"></a><span class="at">@asynccontextmanager</span></span>
<span id="async-timer-13"><a href="#async-timer-13" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> timer():</span>
<span id="async-timer-14"><a href="#async-timer-14" tabindex="-1"></a>    e <span class="op">=</span> Elapsed()</span>
<span id="async-timer-15"><a href="#async-timer-15" tabindex="-1"></a>    t <span class="op">=</span> perf_counter()</span>
<span id="async-timer-16"><a href="#async-timer-16" tabindex="-1"></a>    <span class="cf">yield</span> e</span>
<span id="async-timer-17"><a href="#async-timer-17" tabindex="-1"></a>    e.time <span class="op">=</span> perf_counter() <span class="op">-</span> t</span></code></pre>
</div>
<p>Now we can write:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="cf">async</span> <span class="cf">with</span> timer() <span class="im">as</span> t:</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="cf">await</span> asyncio.sleep(<span class="fl">0.2</span>)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"that took </span><span class="sc">{</span>t<span class="sc">.</span>time<span class="sc">}</span><span class="ss"> seconds"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>that took 0.20058414503000677 seconds</code></pre>
</div>
<p>These few snippets of code require advanced Python knowledge to
understand. Rest assured that both classic coroutines and
<code>asyncio</code> are a large topic to cover, and we’re not going to
cover all of it. At least, we can now time the execution of our
code!</p>
</div>
<div class="section level2">
<h2 id="compute-pi-again">Compute <span class="math inline">\(\pi\)</span> again<a class="anchor" aria-label="anchor" href="#compute-pi-again"></a></h2>
<p>As a reminder, here is our Numba code to compute <span class="math inline">\(\pi\)</span>.</p>
<div class="codewrapper sourceCode" id="calc-pi-numba">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="calc-pi-numba-1"><a href="#calc-pi-numba-1" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="calc-pi-numba-2"><a href="#calc-pi-numba-2" tabindex="-1"></a><span class="im">import</span> numba</span>
<span id="calc-pi-numba-3"><a href="#calc-pi-numba-3" tabindex="-1"></a></span>
<span id="calc-pi-numba-4"><a href="#calc-pi-numba-4" tabindex="-1"></a></span>
<span id="calc-pi-numba-5"><a href="#calc-pi-numba-5" tabindex="-1"></a><span class="at">@numba.njit</span>(nogil<span class="op">=</span><span class="va">True</span>)</span>
<span id="calc-pi-numba-6"><a href="#calc-pi-numba-6" tabindex="-1"></a><span class="kw">def</span> calc_pi(N):</span>
<span id="calc-pi-numba-7"><a href="#calc-pi-numba-7" tabindex="-1"></a>    M <span class="op">=</span> <span class="dv">0</span></span>
<span id="calc-pi-numba-8"><a href="#calc-pi-numba-8" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="calc-pi-numba-9"><a href="#calc-pi-numba-9" tabindex="-1"></a>        <span class="co"># Simulate impact coordinates</span></span>
<span id="calc-pi-numba-10"><a href="#calc-pi-numba-10" tabindex="-1"></a>        x <span class="op">=</span> random.uniform(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="calc-pi-numba-11"><a href="#calc-pi-numba-11" tabindex="-1"></a>        y <span class="op">=</span> random.uniform(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="calc-pi-numba-12"><a href="#calc-pi-numba-12" tabindex="-1"></a></span>
<span id="calc-pi-numba-13"><a href="#calc-pi-numba-13" tabindex="-1"></a>        <span class="co"># True if impact happens inside the circle</span></span>
<span id="calc-pi-numba-14"><a href="#calc-pi-numba-14" tabindex="-1"></a>        <span class="cf">if</span> x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span> <span class="op">&lt;</span> <span class="fl">1.0</span>:</span>
<span id="calc-pi-numba-15"><a href="#calc-pi-numba-15" tabindex="-1"></a>            M <span class="op">+=</span> <span class="dv">1</span></span>
<span id="calc-pi-numba-16"><a href="#calc-pi-numba-16" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">4</span> <span class="op">*</span> M <span class="op">/</span> N</span></code></pre>
</div>
<p>We can send work to another thread with
<code>asyncio.to_thread</code>.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="cf">async</span> <span class="cf">with</span> timer() <span class="im">as</span> t:</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>    <span class="cf">await</span> asyncio.to_thread(calc_pi, <span class="dv">10</span><span class="op">**</span><span class="dv">7</span>)</span></code></pre>
</div>
<div id="gather-multiple-outcomes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="gather-multiple-outcomes" class="callout-inner">
<h3 class="callout-title">Gather multiple outcomes<a class="anchor" aria-label="anchor" href="#gather-multiple-outcomes"></a>
</h3>
<div class="callout-content">
<p>We’ve seen that we can gather multiple coroutines using
<code>asyncio.gather</code>. Now gather several <code>calc_pi</code>
computations, and time them.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="cf">async</span> <span class="cf">with</span> timer() <span class="im">as</span> t:</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> asyncio.gather(</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>       asyncio.to_thread(calc_pi, <span class="dv">10</span><span class="op">**</span><span class="dv">7</span>),</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>       asyncio.to_thread(calc_pi, <span class="dv">10</span><span class="op">**</span><span class="dv">7</span>))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>We can put this into a new function <code>calc_pi_split</code>:</p>
<div class="codewrapper sourceCode" id="async-calc-pi">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="async-calc-pi-1"><a href="#async-calc-pi-1" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> calc_pi_split(N, M):</span>
<span id="async-calc-pi-2"><a href="#async-calc-pi-2" tabindex="-1"></a>    lst <span class="op">=</span> <span class="cf">await</span> asyncio.gather(<span class="op">*</span>(asyncio.to_thread(calc_pi, N) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(M)))</span>
<span id="async-calc-pi-3"><a href="#async-calc-pi-3" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(lst) <span class="op">/</span> M</span></code></pre>
</div>
<p>Now, see if we get a speed up.</p>
<div class="codewrapper sourceCode" id="async-calc-pi-main">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="async-calc-pi-main-1"><a href="#async-calc-pi-main-1" tabindex="-1"></a><span class="cf">async</span> <span class="cf">with</span> timer() <span class="im">as</span> t:</span>
<span id="async-calc-pi-main-2"><a href="#async-calc-pi-main-2" tabindex="-1"></a>    pi <span class="op">=</span> <span class="cf">await</span> asyncio.to_thread(calc_pi, <span class="dv">10</span><span class="op">**</span><span class="dv">8</span>)</span>
<span id="async-calc-pi-main-3"><a href="#async-calc-pi-main-3" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Value of π: </span><span class="sc">{</span>pi<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="async-calc-pi-main-4"><a href="#async-calc-pi-main-4" tabindex="-1"></a></span>
<span id="async-calc-pi-main-5"><a href="#async-calc-pi-main-5" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"that took </span><span class="sc">{</span>t<span class="sc">.</span>time<span class="sc">}</span><span class="ss"> seconds"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Value of π: 3.1418552
that took 2.3300534340087324 seconds</code></pre>
</div>
<div class="codewrapper sourceCode" id="async-calc-pi-main">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="async-calc-pi-main-1"><a href="#async-calc-pi-main-1" tabindex="-1"></a><span class="cf">async</span> <span class="cf">with</span> timer() <span class="im">as</span> t:</span>
<span id="async-calc-pi-main-2"><a href="#async-calc-pi-main-2" tabindex="-1"></a>    pi <span class="op">=</span> <span class="cf">await</span> calc_pi_split(<span class="dv">10</span><span class="op">**</span><span class="dv">7</span>, <span class="dv">10</span>)</span>
<span id="async-calc-pi-main-3"><a href="#async-calc-pi-main-3" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Value of π: </span><span class="sc">{</span>pi<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="async-calc-pi-main-4"><a href="#async-calc-pi-main-4" tabindex="-1"></a></span>
<span id="async-calc-pi-main-5"><a href="#async-calc-pi-main-5" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"that took </span><span class="sc">{</span>t<span class="sc">.</span>time<span class="sc">}</span><span class="ss"> seconds"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Value of π: 3.1416366400000006
that took 0.5876454019453377 seconds</code></pre>
</div>
</div>
</div>
<div class="section level1">
<h1 id="working-with-asyncio-outside-jupyter">Working with <code>asyncio</code> outside Jupyter<a class="anchor" aria-label="anchor" href="#working-with-asyncio-outside-jupyter"></a></h1>
<p>Jupyter already has an asyncronous loop running for us. If you want
to run scripts outside Jupyter you should write an asynchronous main
function and call it using <code>asyncio.run</code>.</p>
<div id="compute-pi-in-a-script" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="compute-pi-in-a-script" class="callout-inner">
<h3 class="callout-title">Compute<span class="math inline">\(\pi\)</span>in a script<a class="anchor" aria-label="anchor" href="#compute-pi-in-a-script"></a>
</h3>
<div class="callout-content">
<p>Collect what we have done so far to compute <span class="math inline">\(\pi\)</span> in parallel into a script and run
it.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>Make sure that you create an <code>async</code> main function, and
run it using <code>asyncio.run</code>. Create a small module called
<code>calc_pi</code>.</p>
<div class="codewrapper sourceCode" id="cb23" file="src/calc_pi/__init__.py">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># file: calc_pi/__init__.py</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="co"># may remain empty</span></span></code></pre>
</div>
<p>Put the Numba code in a separate file
<code>calc_pi/numba.py</code>.</p>
<div class="codewrapper sourceCode" id="cb24" file="src/calc_pi/numba.py">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># file: calc_pi/numba.py</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="op">&lt;&lt;</span>calc<span class="op">-</span>pi<span class="op">-</span>numba<span class="op">&gt;&gt;</span></span></code></pre>
</div>
<p>Put the async timer function in a separate file
<code>async_timer.py</code>.</p>
<div class="codewrapper sourceCode" id="cb25" file="src/async_timer.py">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># file: async_timer.py</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="op">&lt;&lt;</span><span class="cf">async</span><span class="op">-</span>timer<span class="op">&gt;&gt;</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26" file="src/calc_pi/async_pi.py">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># file: calc_pi/async_pi.py</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="im">from</span> async_timer <span class="im">import</span> timer</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="im">from</span> .numba <span class="im">import</span> calc_pi</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="op">&lt;&lt;</span><span class="cf">async</span><span class="op">-</span>calc<span class="op">-</span>pi<span class="op">&gt;&gt;</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> main():</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>    calc_pi(<span class="dv">1</span>)</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>    <span class="op">&lt;&lt;</span><span class="cf">async</span><span class="op">-</span>calc<span class="op">-</span>pi<span class="op">-</span>main<span class="op">&gt;&gt;</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>    asyncio.run(main())</span></code></pre>
</div>
<p>You may run this using <code>python -m calc_pi.async_pi</code>.</p>
</div>
</div>
</div>
</div>
<div id="efficiency" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="efficiency" class="callout-inner">
<h3 class="callout-title">Efficiency<a class="anchor" aria-label="anchor" href="#efficiency"></a>
</h3>
<div class="callout-content">
<p>Play with different subdivisions for <code>calc_pi_split</code> such
that <code>M*N</code> remains constant. How much overhead do you
see?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb27" file="src/calc_pi/granularity.py">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, geom_line, geom_point, aes, scale_y_log10, scale_x_log10</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="im">from</span> .numba <span class="im">import</span> calc_pi</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="im">from</span> .async_pi <span class="im">import</span> calc_pi_split</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="im">from</span> async_timer <span class="im">import</span> timer</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>calc_pi(<span class="dv">1</span>)  <span class="co"># compile the numba function</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> main():</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>    timings <span class="op">=</span> []</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>    <span class="cf">for</span> njobs <span class="kw">in</span> [<span class="dv">2</span><span class="op">**</span>i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">13</span>)]:</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>        jobsize <span class="op">=</span> <span class="dv">2</span><span class="op">**</span><span class="dv">25</span> <span class="op">//</span> njobs</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>jobsize<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>njobs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>        <span class="cf">async</span> <span class="cf">with</span> timer() <span class="im">as</span> t:</span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a>            <span class="cf">await</span> calc_pi_split(jobsize, njobs)</span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a>        timings.append((jobsize, njobs, t.time))</span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a>    timings <span class="op">=</span> pd.DataFrame(timings, columns<span class="op">=</span>(<span class="st">"jobsize"</span>, <span class="st">"njobs"</span>, <span class="st">"time"</span>))</span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a>    plot <span class="op">=</span> ggplot(timings, aes(x<span class="op">=</span><span class="st">"njobs"</span>, y<span class="op">=</span><span class="st">"time"</span>)) <span class="op">\</span></span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a>        <span class="op">+</span> geom_line() <span class="op">+</span> geom_point() <span class="op">+</span> scale_y_log10() <span class="op">+</span> scale_x_log10()</span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a>    plot.save(<span class="st">"asyncio-timings.svg"</span>)</span>
<span id="cb27-25"><a href="#cb27-25" tabindex="-1"></a></span>
<span id="cb27-26"><a href="#cb27-26" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb27-27"><a href="#cb27-27" tabindex="-1"></a>    asyncio.run(main())</span></code></pre>
</div>
<figure><img src="fig/asyncio-timings.svg" alt="a dip at njobs=10 and overhead ~0.1ms per task" class="figure mx-auto d-block"><div class="figcaption">timings</div>
</figure><p>The work takes about 0.1s more when using 1000 tasks, so assuming
that overhead scales linearly with the amount of tasks, we can learn
that the overhead is around 0.1ms per task.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Use the <code>async</code> keyword to write asynchronous code.</li>
<li>Use <code>await</code> to call coroutines.</li>
<li>Use <code>asyncio.gather</code> to collect work.</li>
<li>Use <code>asyncio.to_thread</code> to perform CPU intensive
tasks.</li>
<li>Inside a script: always make an asynchronous <code>main</code>
function, and run it with <code>asyncio.run</code>.</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="exercise-with-fractals.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="extra-external-c.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="exercise-with-fractals.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Exercise with
        </a>
        <a class="chapter-link float-end" href="extra-external-c.html" rel="next">
          Next: Calling external C... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://example.com/template-source/edit/main/episodes/extra-asyncio.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://example.com/template-source/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://example.com/template-source/" class="external-link">Source</a></p>
				<p><a href="https://example.com/template-source/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:j.hidding@esciencecenter.nl">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.2" class="external-link">sandpaper (0.16.2)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://template-source.github.io/NA/extra-asyncio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Asyncio",
  "creativeWorkStatus": "active",
  "url": "https://template-source.github.io/NA/extra-asyncio.html",
  "identifier": "https://template-source.github.io/NA/extra-asyncio.html",
  "dateCreated": "2023-07-03",
  "dateModified": "2023-07-03",
  "datePublished": "2024-03-05"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

